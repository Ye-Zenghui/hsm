# 使用HSM框架的LED控制示例

本示例演示了如何使用HSM（层次式状态机）框架实现一个带有不同工作模式的LED控制器。

## 概述

LED控制器实现了一个层次式状态机，包含以下状态结构：

```
┌─────────────────────────────────────────────────┐
│                   顶层状态                       │
│                                                 │
│   ┌───────────────────────┐  ┌───────────────┐  │
│   │        闪烁状态        │  │   非闪烁状态  │  │
│   │                       │  │               │  │
│   │   ┌───────┐           │  │               │  │
│   │   │  LED开 │           │  │               │  │
│   │   └───────┘           │  │               │  │
│   │                       │──?               │  │
│   │   ┌───────┐           │  │               │  │
│   │   │ LED关  │           │?─┘               │  │
│   │   └───────┘           │                  │  │
│   │                       │                  │  │
│   └───────────────────────┘  └───────────────┘  │
│                                                 │
└─────────────────────────────────────────────────┘
```

## 状态说明

1. **闪烁状态（Blinking）**：LED闪烁模式的父状态，管理闪烁过程
   - **LED开状态（LedOn）**：LED点亮的子状态
   - **LED关状态（LedOff）**：LED熄灭的子状态
2. **非闪烁状态（NotBlinking）**：LED不闪烁的状态（常亮或常灭）

## 状态转换

状态机可以响应以下事件进行状态转换：

- 切换闪烁模式事件：在闪烁和非闪烁状态之间切换
- 定时器事件：在LED开和LED关子状态之间定时切换
- 用户事件：可以触发模式变更

状态进入和退出动作确保在状态之间转换时LED被正确控制。

## 运行示例

示例演示了：

1. 创建状态机实例
2. 使用硬件控制函数初始化状态机
3. 在闪烁和非闪烁模式之间切换
4. 处理定时器事件创建闪烁效果
5. 响应用户事件

## 状态图

下面是详细展示状态间转换的状态图（根据提供的图片）：

```
┌───────────────────────────────────────┐
│             闪烁状态 (Blinking)        │?──────┐
│                                       │       │
│   ┌───────────────┐                   │       │
│   │               │                   │       │
│ ┌─?│  LED开 (LedOn) │─┐                 │       │
│ │ │               │ │                 │       │
│ │ └───────────────┘ │                 │       │
│ │                   │                 │  ┌────┴───────────────┐
│ │                   │                 │  │                    │
│ │ ┌───────────────┐ │                 │  │  非闪烁状态        │
│ │ │               │ │                 │  │  (NotBlinking)     │
│ └─┤ LED关 (LedOff) │?┘                 ├──?                    │
│   │               │                   │  │                    │
│   └───────────────┘                   │  │                    │
│                                       │  │                    │
└───────────────────────────────────────┘  └────────┬───────────┘
                                                    │
                                                    │
                                                    
```

## 硬件集成

在实际应用中：

1. 将模拟的LED控制函数替换为实际的GPIO控制
2. 从定时器中断或系统时钟调用处理函数
3. 实现用户输入处理
4. 根据应用需要调整闪烁频率

## 示例代码

```c
/* 初始化LED状态机 */
led_hsm_t led;
led_hsm_init(&led, led_on_function, led_off_function);

/* 开始闪烁模式 */
led_start_blinking(&led);

/* 停止闪烁（进入非闪烁状态） */
led_stop_blinking(&led);

/* 处理定时器事件（周期性调用） */
led_process_timer(&led);
``` 